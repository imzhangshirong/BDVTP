<!DOCTYPE html>
<html>
    <head>
        <base href="../" />
        <title>大数据虚拟终端平台</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" type="text/css" href="./css/iconfont.css?"/>
        <link rel="stylesheet" type="text/css" href="./css/index.css?t=1244"/>
        <link rel="stylesheet" type="text/css" href="./css/admin.css?t=346747"/>
        <script src="./js/echarts.js"></script>
        <script src="./js/jquery-1.11.3.min.js"></script>
        <!--script src="./js/react/react.js"></script>
        <script src="./js/react/react-dom.js"></script-->
    </head>
    <body>
        <div id="index_top">
            <div class="center">
                <div id="index_logo">
                    <div class="iconfont icon-logo"></div>
                    <div id="index_logo_text">
                        <p style="font-size:16px;">大数据虚拟终端平台</p>
                        <p style="font-size:12px;">Big Data Virtual Terminal Platform</p>
                    </div>
                </div>
                <div id="admin_person">
                    <div id="admin_info">
                        <img id="admin_profile_img" width="40" height="40" src="./images/profile.png"/>
                        <div id="admin_profile_name">咯咯哒的Jarvis</div>
                    </div>
                    <div id="admin_message" class="admin_person_button admin_click">
                        <div class="iconfont icon-xiaoxi"></div>
                        <span>51</span>
                    </div>
                    <div id="admin_setting" class="admin_person_button admin_click">
                        <div class="iconfont icon-shezhi"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="admin_panel" class="center">
            <div id="admin_panel_menu">
                <div class="menu admin_click seleted">
                    <span class="iconfont icon-gaikuang"></span>
                    <span>系统概况</span>
                </div>
                <div class="menu admin_click">
                    <span class="iconfont icon-renwu"></span>
                    <span>任务详情</span>
                </div>
                <div class="menu admin_click">
                    <span class="iconfont icon-jieguo"></span>
                    <span>结果列表</span>
                </div>
                <div class="line"></div>
                <div class="menu admin_click">
                    <span class="iconfont icon-gongdan"></span>
                    <span>提交工单</span>
                    </div>
                <div class="line"></div>
                <div class="menu admin_click">
                    <span class="iconfont icon-shezhi"></span>
                    <span>个人中心</span>
                    </div>
                <div class="line"></div>
                <div class="menu admin_click">
                    <span class="iconfont icon-fankui"></span>
                    <span>我要反馈</span>
                    </div>
            </div>
            <div id="admin_panel_operation">
                <div style="margin-left:10px">
                    <div id="overview_cpu">
                        <p class="title"><span class="title0">CPU</span><span>资源</span></p>
                        <div class="graph"></div>
                        <div class="status"></div>
                    </div>
                    <script>
                        var cpuChart = echarts.init($("#overview_cpu .graph")[0]);
                        var blankData=[];
                        for(var a=0;a<20;a++)blankData[a]=0;
                        var optionCpu = {
                            title:{
                                right:30,
                                textStyle:{fontSize:14,fontWeight:400}
                            },
                            color:[
                                "rgba(65, 160, 221,0.5)",
                                "rgba(85, 171, 128,0.5)",
                                "rgba(102, 153, 204,0.5)",
                            ],
                            animation:false,
                            tooltip: {
                                trigger: 'axis',
                            },
                            grid:{
                                x:30,y:10,x2:20,y2:10
                            },
                            xAxis: {
                                show : false,
                                type : 'category',
                                splitLine: {
                                    show: false
                                },
                                data:blankData.concat()
                            },
                            yAxis: {
                                type: 'value',
                                splitLine: {
                                    show: false
                                },
                                max:100
                            },
                            series: []
                        };
                        var templateCpu=function(data){return '<div class="cpu_core"><p class="title title5 model">'+data.model+'</p><div><p class="titlep1"><span class="titlebig1 mhz">'+data.mhz+'</span>MHz</p></div><div><p class="text titlep1">Cache：<span class="cache">'+data.cache+'</span></p><p class="text titlep1">BogoMIPS：<span class="bogomips">'+data.bogomips+'</span></p></div></div>';};
                        function updateDataCpu(ele,data,data2){
                            for(var a=0;a<ele.length && a<data.length;a++){
                                var keys=Object.keys(data[a]);
                                for(var b=0;b<keys.length;b++){
                                    $(ele[a]).find("."+keys[b]).text(data[a][keys[b]]);
                                }
                            }
                            var time=new Date();
                            optionCpu.xAxis.data.push(time.toLocaleTimeString());
                            optionCpu.title.text="";
                            for(var a=0;a<data2.length;a++){
                                var temp=parseFloat(data2[a].user)+parseFloat(data2[a].sys);
                                temp=Math.round(temp*100)/100;
                                optionCpu.series[a].data.push(temp);
                                optionCpu.title.text+="cpu"+a+":"+temp+"%   ";
                                if(optionCpu.series[a].data.length>30){
                                    optionCpu.series[a].data.shift();
                                }
                            }
                            if(optionCpu.xAxis.data.length>30){
                                optionCpu.xAxis.data.shift();
                            }
                            cpuChart.setOption(optionCpu, true);
                        }
                        function initDataCpu(data){
                            optionCpu.series=[];
                            for(var a=0;a<data.length;a++){
                                $("#overview_cpu .status").append(templateCpu(data[a]));
                                optionCpu.series.push({
                                    name: 'cpu'+a,
                                    type: 'line',
                                    smooth:true, 
                                    data: blankData.concat(),
                                    areaStyle: {normal: {}},
                                    lineStyle: {normal: {}},
                                                
                                });
                            }
                        }
                        function updateCpu(){
                            $.ajax({
                                url:"./admin/api.php?admin/api.php",
                                type:"get",
                                data:{
                                    api:"overview",
                                    action:"cpu"
                                },
                                success:function(resp){
                                    if(resp.code!=0)return;
                                    var info=resp.data.info;
                                    var usage=resp.data.usage;
                                    var cpuNum=$("#overview_cpu .status .cpu_core").length;
                                    if(cpuNum==0){
                                        initDataCpu(info);
                                    }
                                    else if(cpuNum!=info.length){
                                        $("#overview_cpu .status").html();
                                        initDataCpu(info);
                                    }
                                    else{
                                        updateDataCpu($("#overview_cpu .status .cpu_core"),info,usage);

                                    }
                                    
                                }
                            });
                            
                        }
                        updateCpu();
                        setInterval(function(){
                            updateCpu();
                        },3000);
                    </script>
                    <div class="overview_hori">
                        <div id="overview_memory">
                            <p class="title"><span class="title0">内存</span><span>使用情况</span></p>
                            <div class="graph"></div>
                            <div class="graph"></div>                        
                        </div>
                        <script>
                            var memoryChartRAM = echarts.init($("#overview_memory .graph")[0]);
                            var optionMemoryRAM = {
                                title:{
                                    text: '物理内存： 10 GB /12 GB',
                                    left: 'center',
                                    top:'bottom',
                                    textStyle:{fontWeight:300,fontSize:14}
                                },
                                grid:{x:0,y:0,x2:0,y2:10},
                                series: [
                                    {
                                        radius:'90%',
                                        center:['50%','55%'],
                                        name: 'RAM',
                                        type: 'gauge',
                                        axisLine: {            // 坐标轴线
                                            lineStyle: {       // 属性lineStyle控制线条样式
                                                width: 6
                                            },
                                            color:[[0, '#91c7ae'], [0.8, '#63869e'], [1, '#c23531']]
                                        },
                                        axisTick: {            // 坐标轴小标记
                                            show:false,
                                            length: 8,        // 属性length控制线长
                                            lineStyle: {       // 属性lineStyle控制线条样式
                                                color: 'auto',
                                            }
                                        },
                                        splitLine: {           // 分隔线
                                            show:false,
                                            length: 8,         // 属性length控制线长
                                            lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                                                color: 'auto',
                                            }
                                        },
                                        pointer: {width:5},
                                        detail: {formatter:'{value}%',textStyle:{fontSize:20}},
                                        data: [{value: 0,name:"RAM"}]
                                    }
                                ]
                            };
                            memoryChartRAM.setOption(optionMemoryRAM,true);
                            var memoryChartSwap = echarts.init($("#overview_memory .graph")[1]);
                            var optionMemorySwap = {
                                title:{
                                    text: 'Swap交换： 100 MB/5 GB',
                                    left: 'center',
                                    top:'bottom',
                                    textStyle:{fontWeight:300,fontSize:14}
                                },
                                grid:{x:0,y:0,x2:0,y2:10},
                                series: [
                                    {
                                        radius:'90%',
                                        center:['50%','50%'],
                                        name: 'Swap',
                                        type: 'gauge',
                                        axisLine: {            // 坐标轴线
                                            lineStyle: {       // 属性lineStyle控制线条样式
                                                width: 6
                                            }
                                        },
                                        axisTick: {            // 坐标轴小标记
                                            show:false,
                                            length: 8,        // 属性length控制线长
                                            lineStyle: {       // 属性lineStyle控制线条样式
                                                color: 'auto',
                                            }
                                        },
                                        splitLine: {           // 分隔线
                                            show:false,
                                            length: 8,         // 属性length控制线长
                                            lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                                                color: 'auto',
                                            }
                                        },
                                        pointer: {width:5},
                                        detail: {formatter:'{value}%',textStyle:{fontSize:20}},
                                        data: [{value: 0,name:"Swap"}]
                                    }
                                ]
                            };
                            memoryChartSwap.setOption(optionMemorySwap,true);
                            function updateMemory(){
                                $.ajax({
                                    url:"./admin/api.php?admin/api.php",
                                    type:"get",
                                    data:{
                                        api:"overview",
                                        action:"memory"
                                    },
                                    success:function(resp){
                                        if(resp.code!=0)return;
                                        optionMemoryRAM.title.text="物理内存："+resp.data.used[1]+"/"+resp.data.total[1];
                                        optionMemoryRAM.series[0].data[0].value=resp.data.percent;
                                        optionMemorySwap.title.text="Swap交换："+resp.data.swapUsed[1]+"/"+resp.data.swapTotal[1];
                                        optionMemorySwap.series[0].data[0].value=resp.data.swapPercent;
                                        memoryChartRAM.setOption(optionMemoryRAM,true);
                                        memoryChartSwap.setOption(optionMemorySwap,true);
                                    }
                                });
                                
                            }
                            updateMemory();
                            setInterval(function(){
                                updateMemory();
                            },10000);
                        </script>
                    </div>
                    <div class="overview_hori">
                        <div id="overview_space">
                            <p class="title"><span class="title0">空间</span><span>占用</span></p>
                            <div class="graph"></div>
                            <script>
                                var spaceChart = echarts.init($("#overview_space .graph")[0]);
                                var optionSpace = {
                                    title: {
                                        text: '磁盘空间：65 GB/100 GB',
                                        left: 'center',
                                        top:'bottom',
                                        textStyle:{fontWeight:300,fontSize:14}
                                    },
                                    tooltip : {
                                        trigger: 'item',
                                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                                    },
                                    series : [
                                        {
                                            name:'磁盘空间',
                                            type:'pie',
                                            radius : '75%',
                                            center: ['50%', '50%'],
                                            data:[
                                                {value:0, name:'已用',itemStyle:{normal: {color:'#5aa9dc'}}},
                                                {value:100, name:'空闲',itemStyle:{normal: {color:'#dedede'}}},
                                                
                                            ],
                                            animationType: 'scale',
                                            animationEasing: 'elasticOut',
                                        }
                                    ]
                                };
                                spaceChart.setOption(optionSpace,true);
                                function updateSpace(){
                                    $.ajax({
                                        url:"./admin/api.php?admin/api.php",
                                        type:"get",
                                        data:{
                                            api:"overview",
                                            action:"space"
                                        },
                                        success:function(resp){
                                            if(resp.code!=0)return;
                                            optionSpace.title.text="磁盘空间："+resp.data.used[1]+"/"+resp.data.total[1];
                                            optionSpace.series[0].data[0].value=resp.data.used[0];
                                            optionSpace.series[0].data[1].value=resp.data.free[0];
                                            spaceChart.setOption(optionSpace,true);
                                        }
                                    });
                                    
                                }
                                updateSpace();
                                setInterval(function(){
                                    updateSpace();
                                },60000);
                            </script>
                        </div>
                    </div>
                    <div id="overview_net">
                        <p class="title"><span class="title0">网络</span><span>流量</span></p>
                        <div class="graph"></div>
                        
                    </div>
                        <script>
                            var optionNetTemplate = {
                                title:{
                                    right:30,
                                    textStyle:{fontSize:14,fontWeight:400}
                                },
                                color:[
                                    "rgba(65, 160, 221,0.5)",
                                    "rgba(85, 171, 128,0.5)",
                                ],
                                animation:false,
                                tooltip: {
                                    trigger: 'axis',
                                },
                                grid:{
                                    x:50,y:10,x2:20,y2:10
                                },
                                xAxis: {
                                    show : false,
                                    type : 'category',
                                    splitLine: {
                                        show: false
                                    },
                                    data:blankData.concat()
                                },
                                yAxis: {
                                    type: 'value',
                                    splitLine: {
                                        show: false
                                    },
                                    axisLabel:{
                                        formatter:function(value){
                                            function unit(size){
                                                var size_=parseFloat(size);
                                                var unitS=['B','K','M','G'];
                                                var index=0;
                                                while(size_>1024){
                                                    size_/=1024;
                                                    index++;
                                                }
                                                size_=Math.round(size_*10)/10;
                                                return size_+unitS[index];
                                            }
                                            return unit(value);
                                        }
                                    }
                                },
                                series: [
                                    {
                                        name: '下载速度',
                                        type: 'line',
                                        smooth:true, 
                                        data: blankData.concat(),
                                        areaStyle: {normal: {}},
                                        lineStyle: {normal: {}},
                                                    
                                    },
                                    {
                                        name: '上传速度',
                                        type: 'line',
                                        smooth:true, 
                                        data: blankData.concat(),
                                        areaStyle: {normal: {}},
                                        lineStyle: {normal: {}},
                                                    
                                    }
                                ]
                            };
                            var netChart=[];
                            var optionNet=[];
                            var templateNet=function(data){return '<div class="graph"></div>';};
                            function updateDataNet(data){
                                var time=new Date();
                                for(var a=0;a<data.length;a++){
                                    optionNet[a].xAxis.data.push(time.toLocaleTimeString());
                                    optionNet[a].title.text="上传:"+data[a].upload[1]+"   下载:"+data[a].download[1]+" < "+data[a].name;
                                    var download=data[a].download[0];
                                    var upload=data[a].upload[0];
                                    optionNet[a].series[0].data.push(download);
                                    optionNet[a].series[1].data.push(upload);
                                    if(optionNet[a].series[0].data.length>30){
                                        optionNet[a].series[0].data.shift();
                                        optionNet[a].series[1].data.shift();
                                    }
                                    if(optionNet[a].xAxis.data.length>30){
                                        optionNet[a].xAxis.data.shift();
                                    }
                                    netChart[a].setOption(optionNet[a]);
                                }
                            }
                            function initDataNet(data){
                                netChart=[];
                                optionNet=[];
                                for(var a=0;a<data.length;a++){
                                    $("#overview_net").append(templateNet(data[a]));
                                }
                                var all=$("#overview_net .graph");
                                for(var a=0;a<data.length;a++){
                                    netChart.push(echarts.init(all[a]));
                                    optionNet.push(jQuery.extend(true, {}, optionNetTemplate));
                                }
                                console.log("init net");
                            }
                            function updateNet(){
                                $.ajax({
                                    url:"./admin/api.php?admin/api.php",
                                    type:"get",
                                    data:{
                                        api:"overview",
                                        action:"netSpeed"
                                    },
                                    success:function(resp){
                                        if(resp.code!=0)return;
                                        var netNum=$("#overview_net .graph").length;
                                        if(netNum==0){
                                            initDataNet(resp.data);
                                        }
                                        else if(netNum!=resp.data.length){
                                            $("#overview_net .graph").remove();
                                            initDataNet(resp.data);
                                        }
                                        else{
                                            updateDataNet(resp.data);
                                        }
                                    }
                                });
                            }
                            updateNet();
                            setInterval(function(){
                                updateNet();
                            },2000);
                        </script>
                </div>
            </div>
        </div>
        <div id="index_footer">
            <p style="text-align:center;font-size:14px;color:#6F6F6F">Copyright © 2016-2017. All Rights Reserved. BDVTP Alpha</p>
        </div>
    </body>
    
</html>